<!DOCTYPE html>
<html>
<head>
	<title>Mgmt-Users</title>
	<meta charset="utf-8">
	<script
  src="https://code.jquery.com/jquery-3.2.1.js"
  integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
  crossorigin="anonymous"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<style type="text/css">
		ul{
			display: inline-block;
  		float: none;
  		vertical-align: top;
			text-align: center;
		}
	</style>

</head>
<body>
	<div class="jumbotron text-center">
		<h1>Old Milburnie Farm</h1>
		<ul class="nav nav-tabs">
		  <li><a href="#">Main Menu</a></li>
		  <li><a href="#">Tasks</a></li>
		  <li><a href="#">Sales Inventory</a></li>
		  <li><a href="#">Orders</a></li>
		  <li><a href="#">Employee Time</a></li>
		  <li><a href="#">Harvests</a></li>
		  <li><a href="#">Log Out</a></li>
		</ul>
	</div>

<div class="container">
	<div class="panel panel-default">
		
		<div class="panel-heading text-center">
			<h2>Users</h2>
		</div>

			<div class="panel-body">
				<div class="form-group">
					<div class="row">
						<div class="col-md-10 col-md-offset-1">
							<div class="user-container">
								
								<h3>Add User</h3>
								<form id='adduserform'>
									<label>Name</label>
									<input placeholder="Enter a User" id="user-name" type="text" />
									<label>Type</label>
									<select id="user-type">
										<option></option>
										<option>Management</option>
										<option>Employee</option>
										<option>Customer</option>
									</select>
									<label>Username</label>
									<input placeholder="Enter User Name" id="user-username"/>
									<label>Password</label>
									<input placeholder="Enter Password" id="user-password"/>
									<button id="adduser" type="submit" class="btn btn-primary glyphicon glyphicon-plus"></button>
								</form>
								
								<hr>

								<h3>Active Users</h3>
								<table class="table table-striped">
									<thead>
										<th>Name</th>
										<th>Type</th>
										<th>Username</th>
										<th>Password</th>
										<th>Deactivate</th>
									</thead>
									<tbody id="actusrtb"></tbody>
								</table>

								<hr>
								
								<div class="row">
									<div class="col-lg-4">
										<h3>Deactive Users</h3>
									</div>
								</div>
								<table class="table table-striped">
									<thead>
										<th>Name</th>
										<th>Type</th>
										<th>Activate</th>
										<th>Delete</th>
									</thead>
									<tbody id="deactusrtb"> </tbody>
								</table>
							
							</div>
						</div>
					</div>
				</div>
			</div>
		
	</div>
</div>
<script type="text/javascript">

$(document).ready(function() {

	var userName = $('#user-name');
	var userType = $('#user-type');
	var userUname = $('#user-username');
	var userPass = $('#user-password');
	var activeUserList = $('#actusrtb');
	var deactiveUserList = $('#deactusrtb');
	
	$("#adduser").click(addUser);
	$(document).on("click", "button.user_deactivate",deactivateUser);
	$(document).on("click", "button.user_activate",activateUser);
	$(document).on("click", "button.user_delete",deleteUser);
	
	getUsers();

	function resetList(){
		activeUserList.empty();
  	deactiveUserList.empty();
  	getUsers();
	};

	function getUsers(){
		$.get("/api/users", function(data){			
			for (var i = 0; i < data.length; i++) {
				if(data[i].active == true){
					createActiveUserRow(data[i]);
				}
				else{
					createDeactiveUserRow(data[i]);
				}
			};
		});
	};

	function addUser(event) {
    event.preventDefault(); 
    var newUser = {
			name: userName.val().trim(),
			type: userType.val().trim(),
			username: userUname.val().trim(),
			password: userPass.val().trim()
		}
    $.post("/api/users",newUser,resetList);
  }

	function createActiveUserRow(aUserData){
		var newTr = $('<tr>');
		newTr.append("<td data-id='" + aUserData.id + "'>" + aUserData.name + "</td>");
		newTr.append("<td data-id='" + aUserData.id + "'>" + aUserData.type + "</td>");
		newTr.append("<td data-id='" + aUserData.id + "'>" + aUserData.username + "</td>");
		newTr.append("<td><button data-id='"+aUserData.id+"' type='button' class='user_password btn btn-primary glyphicon glyphicon-modal-window' data-toggle='modal' data-target='.bs-example-modal-sm'></button></td>");
		newTr.append("<td><button data-id='"+aUserData.id+"' class='user_deactivate btn btn-primary glyphicon glyphicon-hand-down'></button></td>");
		newTr.append("</tr>");
		activeUserList.append(newTr);
	}

	
	function createDeactiveUserRow(dUserData){
		var newTr = $('<tr>');
		newTr.append("<td data-id='" + dUserData.id + "'>" + dUserData.name + "</td>");
		newTr.append("<td data-id='" + dUserData.id + "'>" + dUserData.type + "</td>");
		newTr.append("<td><button data-id='"+dUserData.id+"' class='user_activate btn btn-primary glyphicon glyphicon-hand-up'></button></td>");
		newTr.append("<td><button data-id='"+dUserData.id+"' class='user_delete btn btn-danger glyphicon glyphicon-remove'></button></td>");
		newTr.append("</tr>");
		deactiveUserList.append(newTr);
	}

	function deactivateUser (event){
		event.stopPropagation();
		var id = $(this).data("id");
    $.ajax({
      method: "PUT",
      url: "/api/users/deactivate/" + id
    }).done(resetList);
	}

	function activateUser (event){
		event.stopPropagation();
		var id = $(this).data("id");
    $.ajax({
      method: "PUT",
      url: "/api/users/activate/" + id
    }).done(resetList);
	}

	function deleteUser(event){
		event.stopPropagation();
    var id = $(this).data("id");
    $.ajax({
      method: "DELETE",
      url: "/api/users/" + id
    }).done(resetList);
	}

});

</script>
</body>
</html>